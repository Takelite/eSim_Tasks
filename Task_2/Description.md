# Symbol Library Generator – IHP PDK to eSim `.lib` Format

## Objective

This Python script was developed for **Task 2**, which focuses on **converting component symbols from the IHP PDK into the `.lib` format used by eSim**. It specifically processes `.sym` files generated by **xschem** and translates them into a symbol format readable by **KiCad**, which is the base schematic editor used in **eSim**.

---

## Why Is This Conversion Necessary?

- **IHP PDK** provides components and symbols primarily for professional IC design tools and formats.
- **eSim**, on the other hand, expects **KiCad-compatible symbol libraries (`.lib` files)**.
- The `.sym` files used in xschem (part of the IHP design workflow) are **not directly compatible** with KiCad/eSim.
- So, this script serves as a **bridge** between these tools, allowing IHP components to be reused inside eSim projects.

---

## Key Concepts & Differences

- **xschem Format**:
  - `.sym` files are used for symbol definition in the xschem environment.
  - Pin details are encoded using custom syntax (e.g., `B name=A dir=in`).

- **eSim/KiCad Format**:
  - Uses `.lib` symbol libraries written in a very specific textual structure.
  - Needs clear pin directions, labels, symbol body geometry (arcs, lines), and proper pin placement.
  - Cannot directly interpret xschem’s internal structure without translation.

---

## What This Script Does

### Parsing

- The function `parse_xschem_sym(sym_path)`:
  - Opens and reads the `.sym` file line-by-line.
  - Searches for the **symbol name** using the `template=` field.
  - Identifies all **pins** from lines starting with `B`, extracting the `name` and `dir` (direction: input or output).
  - Returns the symbol name and list of pins to be converted.

### Symbol Generation

- The function `generate_lib(symbol_name, pins, output_file)`:
  - Creates a new `.lib` file with the **required eSim format headers**.
  - Draws a basic symbol body using a **rectangle and an arc** to resemble a logic gate.
  - Places input pins on the left side and output pins on the right.
  - Properly assigns coordinates and orientation (direction: `I` for input, `O` for output).
  - Writes the final `.lib` file with **correct structure** using `DRAW`, `X`, `ENDDRAW`, and `ENDDEF` blocks.

---

## Example Execution

```python
sym_file = "sg13g2_and2_1.sym"
symbol_name, pins = parse_xschem_sym(sym_file)
generate_lib(symbol_name, pins, "converted.lib")
```

## How to Use This in VS Code

### Prepare the Input:
* Place your `.sym` file (e.g., `sg13g2_and2_1.sym`) in the same folder as the script or give the full path.

### Open VS Code:
* Launch **VS Code** and open the folder containing your Python script.

### Run the Script:
* Open a terminal and execute:
  
```bash
  python your_script_name.py
```

### Check the Output

* A `.lib` file will be created (e.g., `converted.lib`).
* You can now import this `.lib` file into **eSim’s symbol library** via its library manager or by adding it to your project’s library path.

---

## How to Add the symbol in eSim

* Open the schematic window in eSim and click on the Library Editor Button.
* From this window click on import component button and select the generated `.lib` file from vscode.
* This should successfully load the component symbol in the eSim Library Editor Window


### Additional Notes

* The generated `.lib` file is **minimal but compatible** with eSim.
* This approach assumes a **rectangular symbol body** and **evenly spaced input pins**. You may customize the shape and structure based on the type of component.
* Only **basic symbols** (with defined inputs and outputs) are currently supported.
* Advanced symbol features such as:
  * multiple units,
  * hidden pins,
  * alternate body shapes
  are **not handled yet**.
* The script is modular and can be **easily extended** to:
  * handle batch conversion of multiple `.sym` files,
  * include aliases,
  * assign correct pin numbers from a CSV or database.

---

### Summary

This script provides a **lightweight and effective solution** for migrating **xschem component symbols from IHP PDKs** into the **KiCad/eSim-compatible `.lib` format**.

It demonstrates how to:

* Parse a `.sym` file,
* Extract pin and symbol metadata,
* Write a clean and structured `.lib` symbol file.

This tool is highly useful for integrating IHP components into academic or open-source eSim projects, making them more accessible for schematic simulation and layout workflows.

